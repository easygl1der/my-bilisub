# 字幕分析工具使用说明

## 功能概述

这个简化的字幕分析工具主要实现以下功能：

1. **读取字幕文件** - 支持 SRT 格式
2. **生成书面文稿** - 将字幕内容整理成精炼的书面表达
3. **风格分析** - 自动检测是否为新闻类内容
4. **内容分析** - 根据风格提取不同的分析结果：
   - 非新闻类：提取论点和论据
   - 新闻类：提取新闻要点（事件、时间、地点、人物、关键信息、影响）
5. **对话识别** - 自动识别对话式内容并提取人物对话

## 使用方法

### 1. 安装依赖

```bash
pip install google-genai
```

### 2. 配置 API Key

创建配置文件 `config/config_api.py`：

```python
API_CONFIG = {
    'gemini': {
        'api_key': 'your-gemini-api-key-here'
    }
}
```

或者设置环境变量：
```bash
export GEMINI_API_KEY="your-gemini-api-key-here"
```

### 3. 运行工具

#### 分析单个文件

```bash
python analysis/subtitle_analyzer.py -i video.srt -o output/
```

#### 分析整个文件夹

```bash
python analysis/subtitle_analyzer.py -d /path/to/subtitles -o output/
```

#### 指定模型

```bash
python analysis/subtitle_analyzer.py -i video.srt -o output/ -m flash
```

模型选项：
- `flash-lite` (默认) - 速度较快，成本较低
- `flash` - 平衡性能和效果
- `pro` - 最佳效果，成本较高

## 输出格式

每个字幕文件会生成一个 Markdown 格式的分析报告，包含：

### 1. 基本信息栏
- 生成时间
- 视频风格（新闻类/非新闻类）
- 是否为对话式
- 使用的模型
- Token 统计

### 2. 书面文稿
- 去除口语化表达的精炼书面内容
- 保持完整性和准确性

### 3. 分析结果
#### 非新闻类内容
- 论点列表
  - 核心观点
  - 支持论据（多个）
  - 可信度评估（高/中/低）

#### 新闻类内容
- 新闻要点列表
  - 事件名称
  - 发生时间
  - 事件地点
  - 涉及人物/机构
  - 关键信息
  - 影响/结果

#### 对话式内容
- 结构化的对话记录
- 按人物分组的内容
- 保持对话完整性

### 4. 源文件信息
- 指向原始 SRT 文件的引用

## 视频风格检测

工具会自动检测视频内容类型：

- **新闻类**：包含"新闻"、"报道"、"事件"、"时事"、"热点"、"突发"、"最新"、"消息"等关键词
- **非新闻类**：其他类型内容（技术教程、故事分享、知识科普等）

## 对话识别

工具会根据以下特征自动识别对话式内容：
- 字幕中包含"说"、"问"、"回答"、"采访"等关键词
- 标题中包含相关词汇

## 性能优化

- 自动截断过长的字幕内容（默认 15,000 字符）
- 保留前 80% 的内容，避免信息丢失
- Token 使用统计，便于成本控制

## 错误处理

- API 调用失败时会显示详细错误信息
- 文件格式检查，确保只处理 SRT 文件
- 路径检查，避免文件不存在导致的错误

## 示例输出

```
# 视频标题 字幕分析报告

**生成时间**: 2024-02-25 14:30:45
**视频风格**: 非新闻类
**对话式**: 否
**使用模型**: flash-lite
**Token统计**: 输入 1,234 | 输出 567 | 总计 1,801

---

## 📝 书面文稿
[精炼的书面内容...]

## 📊 分析结果
### 论点 1
- **论点**: [核心观点]
- **论据1**: [支持论据1]
- **论据2**: [支持论据2]
- **可信度**: [高/中/低]

---

**源文件**: video.srt
```