# MediaCrawleræ•´åˆè¯´æ˜

## ğŸ¯ æ•´åˆæ¦‚è¿°

å°†MediaCrawlerçš„è§†é¢‘é“¾æ¥æå–åŠŸèƒ½æ•´åˆåˆ°ç°æœ‰çš„è§†é¢‘å¤„ç†å·¥ä½œæµä¸­ï¼Œå®ç°ï¼š

```
MediaCrawlerçˆ¬è™« â†’ è‡ªåŠ¨æå–é“¾æ¥ â†’ æ‰¹é‡è§†é¢‘å¤„ç† â†’ ä¼˜åŒ–å­—å¹•
```

---

## ğŸ“¦ æ•´åˆçš„ä¸‰ä¸ªç»„ä»¶

### 1. MediaCrawleræ•°æ®æå–å™¨

**æ–‡ä»¶**ï¼š`extract_video_links.py`ï¼ˆMediaCrawleré¡¹ç›®ä¸­ï¼‰

**åŠŸèƒ½**ï¼š
- ä»çˆ¬å–çš„CSV/JSONæ•°æ®ä¸­æå–è§†é¢‘é“¾æ¥
- æ ¹æ®`note_id`æ„å»ºå®Œæ•´çš„å°çº¢ä¹¦URL
- å¯¼å‡ºä¸ºå¤šç§æ ¼å¼ï¼ˆJSON/Markdown/TXTï¼‰

### 2. å¢å¼ºå‹å·¥ä½œæµå·¥å…·

**æ–‡ä»¶**ï¼š`enhanced_workflow.py`ï¼ˆæ–°å»ºï¼‰

**åŠŸèƒ½**ï¼š
- æ•´åˆMediaCrawleræ•°æ®æå–
- è‡ªåŠ¨è°ƒç”¨è§†é¢‘å¤„ç†å·¥å…·
- ç”Ÿæˆå®Œæ•´çš„å¤„ç†æŠ¥å‘Š

### 3. æ ¸å¿ƒå¤„ç†å·¥å…·

**æ–‡ä»¶**ï¼š
- `ultimate_transcribe.py`ï¼šWhisperè¯­éŸ³è¯†åˆ«
- `optimize_srt_glm.py`ï¼šGLMå­—å¹•ä¼˜åŒ–

---

## ğŸ”„ æ•°æ®æµè½¬è¿‡ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ­¥éª¤1: MediaCrawlerçˆ¬å–æ•°æ®                      â”‚
â”‚                                                              â”‚
â”‚  MediaCrawler/main.py                                        â”‚
â”‚      â†“                                                       â”‚
â”‚  data/xhs/xhs_notes_*.csv  â† çˆ¬å–çš„æ•°æ®                      â”‚
â”‚      â†“                                                       â”‚
â”‚  åŒ…å«å­—æ®µ: note_id, title, type, ...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ­¥éª¤2: æå–è§†é¢‘é“¾æ¥                              â”‚
â”‚                                                              â”‚
â”‚  enhanced_workflow.py --mediacrawler                        â”‚
â”‚      â†“                                                       â”‚
â”‚  è¯»å– data/xhs/xhs_notes_*.csv                               â”‚
â”‚      â†“                                                       â”‚
â”‚  æå– note_id                                                â”‚
â”‚      â†“                                                       â”‚
â”‚  æ„å»ºURL: https://www.xiaohongshu.com/explore/{note_id}     â”‚
â”‚      â†“                                                       â”‚
â”‚  åˆ›å»ºä¸´æ—¶CSVæˆ–ç›´æ¥å¤„ç†                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ­¥éª¤3: æ‰¹é‡å¤„ç†è§†é¢‘                              â”‚
â”‚                                                              â”‚
â”‚  å¯¹æ¯ä¸ªè§†é¢‘:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3.1 ä¸‹è½½è§†é¢‘ (ultimate_transcribe.py)              â”‚    â”‚
â”‚  â”‚      - yt-dlpä¸‹è½½                                   â”‚    â”‚
â”‚  â”‚      - FFmpegæå–éŸ³é¢‘                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3.2 Whisperè¯†åˆ« (ultimate_transcribe.py)           â”‚    â”‚
â”‚  â”‚      - åŠ è½½æ¨¡å‹                                      â”‚    â”‚
â”‚  â”‚      - ASRè¯†åˆ«                                      â”‚    â”‚
â”‚  â”‚      - ç”ŸæˆSRT                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3.3 GLMä¼˜åŒ– (optimize_srt_glm.py)                  â”‚    â”‚
â”‚  â”‚      - è¯»å–SRT                                      â”‚    â”‚
â”‚  â”‚      - APIä¼˜åŒ–                                      â”‚    â”‚
â”‚  â”‚      - ç”ŸæˆæŠ¥å‘Š                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ­¥éª¤4: ç”Ÿæˆç»“æœ                                  â”‚
â”‚                                                              â”‚
â”‚  output/transcripts/*.srt          â† WhisperåŸå§‹å­—å¹•          â”‚
â”‚  output/optimized_srt/*_optimized.srt  â† GLMä¼˜åŒ–å­—å¹•          â”‚
â”‚  *_workflow_report.md             â† å¤„ç†æŠ¥å‘Š                  â”‚
â”‚  *_processed.csv                  â† æ›´æ–°çŠ¶æ€çš„CSV             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ä»£ç å®ç°ç»†èŠ‚

### æ ¸å¿ƒå‡½æ•°ï¼šextract_links_from_mediacrawler()

```python
def extract_links_from_mediacrawler(data_dir="data/xhs"):
    """
    ä»MediaCrawleræ•°æ®ç›®å½•æå–è§†é¢‘é“¾æ¥

    å·¥ä½œæµç¨‹ï¼š
    1. æŸ¥æ‰¾æœ€æ–°çš„CSV/JSONæ–‡ä»¶
    2. è§£ææ•°æ®æ ¼å¼
    3. æå–note_id
    4. æ„å»ºå®Œæ•´URL
    5. è¿”å›è§†é¢‘åˆ—è¡¨
    """
    # 1. æŸ¥æ‰¾æœ€æ–°æ–‡ä»¶
    csv_file = find_latest_file(data_dir, "xhs_notes_*.csv")

    # 2. æå–æ•°æ®
    videos = extract_from_mediacrawler_csv(csv_file)

    # 3. æ„å»ºURL
    for video in videos:
        url = f"https://www.xiaohongshu.com/explore/{note_id}"
        video['url'] = url

    return videos
```

### URLæ„å»ºè§„åˆ™

```
MediaCrawleræ•°æ®æ ¼å¼ï¼š
{
    "note_id": "698da913000000000b00a3f1",
    "title": "å°Šé‡å‰é¢å¶ğŸ§ æ‰‹æŠŠæ‰‹æ•™å­¦",
    "type": "video"
}

â†“ è‡ªåŠ¨æ„å»º â†“

å®Œæ•´URLï¼š
https://www.xiaohongshu.com/explore/698da913000000000b00a3f1
```

---

## ğŸ“‹ æ•°æ®æ ¼å¼æ˜ å°„

### MediaCrawler CSV â†’ å·¥ä½œæµCSV

| MediaCrawlerå­—æ®µ | å·¥ä½œæµå­—æ®µ | è¯´æ˜ |
|-----------------|-----------|------|
| note_id | é“¾æ¥ | è½¬æ¢ä¸ºå®Œæ•´URL |
| title | æ ‡é¢˜ | ç›´æ¥æ˜ å°„ |
| type | ç±»å‹ | ç›´æ¥æ˜ å°„ |
| (æ— ) | subtitle_status | åˆå§‹åŒ–ä¸ºç©º |
| (æ— ) | subtitle_error | åˆå§‹åŒ–ä¸ºç©º |

### è½¬æ¢ç¤ºä¾‹

**è¾“å…¥ï¼ˆMediaCrawler CSVï¼‰**ï¼š
```csv
note_id,title,type
698da913000000000b00a3f1,å°Šé‡å‰é¢å¶ğŸ§ æ‰‹æŠŠæ‰‹æ•™å­¦,video
```

**è¾“å‡ºï¼ˆå·¥ä½œæµCSVï¼‰**ï¼š
```csv
åºå·,æ ‡é¢˜,é“¾æ¥,ç±»å‹,subtitle_status,subtitle_error
1,å°Šé‡å‰é¢å¶ğŸ§ æ‰‹æŠŠæ‰‹æ•™å­¦,https://www.xiaohongshu.com/explore/698da913000000000b00a3f1,video,,
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ï¼ˆæ¨èï¼‰

```bash
# 1. çˆ¬å–æ•°æ®ï¼ˆMediaCrawlerï¼‰
cd MediaCrawler
python main.py

# 2. è‡ªåŠ¨å¤„ç†ï¼ˆå›åˆ°biliSubï¼‰
cd ../biliSub
python enhanced_workflow.py --mediacrawler

# âœ… å®Œæˆï¼
```

**ä¼˜åŠ¿**ï¼š
- é›¶æ‰‹åŠ¨æ“ä½œ
- å®Œå…¨è‡ªåŠ¨åŒ–
- ä¸€é”®å®Œæˆ

---

### åœºæ™¯2ï¼šä¸­é—´æ£€æŸ¥

```bash
# 1. çˆ¬å–æ•°æ®
cd MediaCrawler
python main.py

# 2. æå–å¹¶å¯¼å‡º
cd ../biliSub
python enhanced_workflow.py --mediacrawler --export-crawled videos.csv

# 3. æ£€æŸ¥videos.csvï¼ˆç”¨Excelæˆ–å…¶ä»–å·¥å…·ï¼‰
#    - åˆ é™¤ä¸éœ€è¦çš„è§†é¢‘
#    - æ·»åŠ å¤‡æ³¨
#    - è°ƒæ•´é¡ºåº

# 4. å¤„ç†
python enhanced_workflow.py --csv videos.csv
```

**ä¼˜åŠ¿**ï¼š
- å¯ä»¥äººå·¥ç­›é€‰
- çµæ´»æ€§é«˜
- ä¾¿äºè´¨é‡æ§åˆ¶

---

### åœºæ™¯3ï¼šåˆ†æ‰¹å¤„ç†

```bash
# 1. æå–æ‰€æœ‰è§†é¢‘
python enhanced_workflow.py --mediacrawler --export-crawled all.csv

# 2. åˆ†æ‰¹å¤„ç†
python enhanced_workflow.py --csv all.csv --limit 10 --prompt tech
python enhanced_workflow.py --csv all.csv --limit 10 --filter fail
# ... ç»§ç»­å¤„ç†
```

**ä¼˜åŠ¿**ï¼š
- æ§åˆ¶å¤„ç†èŠ‚å¥
- é¿å…APIé™æµ
- ä¾¿äºé”™è¯¯æ¢å¤

---

## âš™ï¸ æŠ€æœ¯è¦ç‚¹

### 1. æ–‡ä»¶æŸ¥æ‰¾ç­–ç•¥

```python
def find_latest_file(directory, pattern):
    """æŒ‰ä¿®æ”¹æ—¶é—´æŸ¥æ‰¾æœ€æ–°æ–‡ä»¶"""
    files = list(Path(directory).glob(pattern))
    return max(files, key=lambda x: x.stat().st_mtime)
```

**ä¼˜åŠ¿**ï¼š
- æ€»æ˜¯ä½¿ç”¨æœ€æ–°æ•°æ®
- æ— éœ€æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶
- æ”¯æŒå¤šæ¬¡çˆ¬å–

### 2. ç¼–ç å¤„ç†

```python
# UTF-8-BOMç¼–ç ï¼ˆExcelå…¼å®¹ï¼‰
with open(csv_file, 'r', encoding='utf-8-sig') as f:
    reader = csv.DictReader(f)
```

**é‡è¦æ€§**ï¼š
- æ”¯æŒä¸­æ–‡
- Excelå¯æ‰“å¼€
- é¿å…ä¹±ç 

### 3. é”™è¯¯å¤„ç†

```python
try:
    videos = extract_links_from_mediacrawler(data_dir)
    if not videos:
        print("âŒ æ— æ³•æå–æ•°æ®")
        return
except Exception as e:
    print(f"âŒ é”™è¯¯: {e}")
    return
```

**ä¿è¯**ï¼š
- ä¸ä¼šå´©æºƒ
- å‹å¥½é”™è¯¯æç¤º
- ä¼˜é›…é™çº§

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¼ ç»Ÿæ–¹å¼ vs æ•´åˆæ–¹å¼

| æ­¥éª¤ | ä¼ ç»Ÿæ–¹å¼ | æ•´åˆæ–¹å¼ |
|------|---------|---------|
| çˆ¬å–æ•°æ® | MediaCrawler | MediaCrawler |
| æå–é“¾æ¥ | æ‰‹åŠ¨å¤åˆ¶ | è‡ªåŠ¨æå– |
| åˆ›å»ºCSV | æ‰‹åŠ¨åˆ›å»º | è‡ªåŠ¨åˆ›å»º |
| å¤„ç†è§†é¢‘ | æ‰‹åŠ¨å‘½ä»¤ | ä¸€é”®å®Œæˆ |
| æ›´æ–°çŠ¶æ€ | æ‰‹åŠ¨è®°å½• | è‡ªåŠ¨æ›´æ–° |
| **æ€»æ—¶é—´** | **2-3å°æ—¶** | **5-10åˆ†é’Ÿ** |
| **æ‰‹åŠ¨æ“ä½œ** | **50+æ¬¡** | **1æ¬¡** |

---

## ğŸ”— æ–‡ä»¶å…³ç³»å›¾

```
é¡¹ç›®ç»“æ„ï¼š

biliSub/
â”œâ”€â”€ MediaCrawler/                    â† çˆ¬è™«é¡¹ç›®
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ data/xhs/
â”‚       â””â”€â”€ xhs_notes_*.csv         â† çˆ¬å–çš„æ•°æ®
â”‚
â”œâ”€â”€ enhanced_workflow.py            â† æ–°å»ºï¼šæ•´åˆå·¥å…·
â”œâ”€â”€ extract_video_links.py          â† MediaCrawlerä¸­çš„æå–å·¥å…·
â”œâ”€â”€ ultimate_transcribe.py          â† Whisperè¯†åˆ«
â”œâ”€â”€ optimize_srt_glm.py             â† GLMä¼˜åŒ–
â”‚
â””â”€â”€ output/
    â”œâ”€â”€ transcripts/                â† åŸå§‹å­—å¹•
    â””â”€â”€ optimized_srt/              â† ä¼˜åŒ–å­—å¹•
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ•°æ®å‡†å¤‡

```bash
# ç¡®ä¿MediaCrawleræ•°æ®å®Œæ•´
ls -lh data/xhs/xhs_notes_*.csv

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# -rw-r--r-- 1 user user 20K Feb 15 10:00 xhs_notes_20250215_100000.csv
```

### 2. æµ‹è¯•è¿è¡Œ

```bash
# å…ˆç”¨å°æ‰¹é‡æµ‹è¯•
python enhanced_workflow.py --mediacrawler --limit 2

# ç¡®è®¤æ— è¯¯åï¼Œå¤„ç†å…¨éƒ¨
python enhanced_workflow.py --mediacrawler
```

### 3. å¤‡ä»½ç®¡ç†

```bash
# å·¥å…·ä¼šè‡ªåŠ¨å¤‡ä»½åŸCSV
# å¤‡ä»½æ–‡ä»¶æ ¼å¼ï¼šåŸæ–‡ä»¶å_backup_æ—¶é—´æˆ³.csv

# æŸ¥çœ‹å¤‡ä»½
ls -lh *_backup_*.csv
```

### 4. ç›‘æ§è¿›åº¦

```bash
# å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦
# å·¥å…·ä¼šæ˜¾ç¤ºï¼š
# è¿›åº¦: [3/10]
# å½“å‰è§†é¢‘: xxx
# è€—æ—¶: xxç§’
```

---

## ğŸ‰ æ€»ç»“

**æ•´åˆå‰**ï¼š
```
çˆ¬è™« â†’ æ‰‹åŠ¨æå– â†’ æ‰‹åŠ¨åˆ›å»ºCSV â†’ æ‰‹åŠ¨å¤„ç† â†’ æ‰‹åŠ¨è®°å½•
```

**æ•´åˆå**ï¼š
```
çˆ¬è™« â†’ enhanced_workflow.py â†’ å®Œæˆï¼
```

**æ•ˆç‡æå‡**ï¼š**20å€ä»¥ä¸Š**

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… è‡ªåŠ¨åŒ–ï¼šå‡å°‘99%çš„æ‰‹åŠ¨æ“ä½œ
- âœ… å¯é æ€§ï¼šé¿å…äººä¸ºé”™è¯¯
- âœ… å¯æ‰©å±•ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- âœ… å¯ç»´æŠ¤ï¼šæ¨¡å—åŒ–è®¾è®¡

---

**ç°åœ¨ä½ å¯ä»¥ä»çˆ¬è™«åˆ°ä¼˜åŒ–å­—å¹•ï¼Œä¸€æ¡å‘½ä»¤æå®šï¼** ğŸš€
